<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login | Meemon</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{background:#0b0611;color:#fff;font-family:sans-serif;display:grid;place-items:center;height:100vh;margin:0}
    .box{width:min(420px,92vw);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:18px}
    button{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(212,175,55,.5);background:#a3121b;color:#fff;font-weight:700;cursor:pointer}
    pre{white-space:pre-wrap;word-break:break-word;opacity:.9}
  </style>
</head>
<body>
  <div class="box">
    <h2>Login with LINE</h2>
    <button id="loginBtn" disabled>กำลังโหลด…</button>
    <pre id="log"></pre>
  </div>

  <script>
    const LIFF_ID = "2008685502-15M0VarU";

    const logEl = document.getElementById("log");
    const btn = document.getElementById("loginBtn");
    const log = (m) => logEl.textContent += m + "\n";

    (async () => {
      try {
        log("Starting LIFF init…");
        await liff.init({ liffId: LIFF_ID });
        log("LIFF init OK");

        btn.disabled = false;

        if (liff.isLoggedIn()) {
          log("Already logged in → getProfile");
          const p = await liff.getProfile();
          localStorage.setItem("meemon_line_user", JSON.stringify({
            userId: p.userId, name: p.displayName, picture: p.pictureUrl
          }));
          log("Saved profile → redirect to draw.html");
          location.href = "./draw.html";
          return;
        }

        log("Not logged in → waiting for click");
        btn.textContent = "Login with LINE";
        btn.onclick = () => {
          log("Calling liff.login()…");
          // redirect กลับมาหน้าเดิมหลังล็อกอิน (ช่วยมากเวลามี path)
          liff.login({ redirectUri: location.href });
        };

      } catch (e) {
        log("❌ ERROR:");
        log(String(e?.message || e));
        log("เช็ค: Endpoint URL ใน LIFF ต้องเป็น GitHub Pages URL ของคุณ");
        btn.textContent = "Login ไม่ได้ (ดู error ด้านล่าง)";
      }
    })();
  </script>
</body>
</html>
